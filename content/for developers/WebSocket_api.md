+++
title = "WebSocket API"
head ="<label>WebSocket API</label> "
# Type of content, set "slide" to display it fullscreen with reveal.js
type="page"

# Creator's Display name
creatordisplayname = "Alaze"
# Creator's Email
creatoremail = ""
# LastModifier's Display name
lastmodifierdisplayname = "Alaze"
# LastModifier's Email
lastmodifieremail = ""
+++

{{% tabs_script %}}

**Stegos Node** offers experimental asynchronous **WebSocket API**. This API allow you to manage accounts, create and track transactions, receive notifications and so on.

* [Prerequisites]({{< relref "#prerequisites" >}})
* [Protocol]({{< relref "#protocol" >}})
  + [Framing]({{< relref "#framing" >}})
  + [Payload]({{< relref "#payload" >}})
  + [Remote Procedure Calls]({{< relref "#remote-procedure-calls" >}})
  + [Notifications]({{< relref "#notifications" >}})
* [Wallet RPC API]({{< relref "#wallet-rpc-api" >}})
  + [List Accounts]({{< relref "#list-accounts" >}})
  + [Create Account]({{< relref "#create-account" >}})
  + [Delete Account]({{< relref "#delete-account" >}})
  + [Getting Recovery Phrase]({{< relref "#get-recovery-phrase" >}})
  + [Recover Account]({{< relref "#recover-account" >}})
  + [Unseal Account]({{< relref "#unseal-account" >}})
  + [Seal Account]({{< relref "#seal-account" >}})
  + [Account Information]({{< relref "#account-information" >}})
  + [Change Password]({{< relref "#change-password" >}})
  + [Account Information]({{< relref "#account-information" >}})
  + [Balance Information]({{< relref "#balance-information" >}})
  + [UTXO Information]({{< relref "#utxo-information" >}})
  + [Payment]({{< relref "#payment" >}})
  + [Cloak]({{< relref "#cloak" >}})
  + [Stake]({{< relref "#stake" >}})
  + [Unstake]({{< relref "#unstake" >}})
  + [Restake]({{< relref "#restake" >}})
  + [Validate Certificate]({{< relref "#validate-certificate" >}})
  + [Payment History]({{< relref "#payment-history" >}})
* [Wallet Notifications]({{< relref "#wallet-notifications" >}})
  + [Balance Changed]({{< relref "#balance_changed" >}})
  + [Tokens Received]({{< relref "#tokens-received" >}})
  + [Tokens Spent]({{< relref "#tokens-spent" >}})
  + [Tokens Staked]({{< relref "#tokens-staked" >}})
  + [Tokens Unstaked]({{< relref "#tokens-unstak" >}})
  + [Transaction Status]({{< relref "#transaction-status" >}})
  + [Snowball Status]({{< relref "#snowball-status" >}})
* [Node RPC API]({{< relref "#node-rpc-api" >}})
  + [Escrow Information]({{< relref "#escrow-information" >}})
  + [Election Information]({{< relref "#election-information" >}})
  + [Enable Restaking]({{< relref "#enable-restaking" >}})
  + [Pop Block]({{< relref "#pop-block" >}})
* [Node Notifications]({{< relref "#node-notifications" >}})
  + [Synchronization Status Changed]({{< relref "#synchronization-status-changed" >}})
  + [New Micro Block]({{< relref "#new-micro_block" >}})
  + [Rollback Micro Block]({{< relref "#rollback-micro-block" >}})
  + [New Macro Block]({{< relref "#new-macro_block" >}})
* [Use Cases]({{< relref "#use-cases" >}})
  + [Transaction Tracking]({{< relref "#transaction-tracking" >}})

___

### Prerequisites

* [**Node is up and running**]({{< relref "../getting started/Running_a_Node.md">}})
* Any [**WebSocket client library**](https://github.com/facundofarias/awesome-websockets) or a browser.

By default, **Node** starts WebSocket API server on `ws://127.0.0.1:3144/` . You can override this value by providing `--api-endpoint` command-line option to **Node** or by setting `STEGOS_API_ENDPOINT` environment variable.

To communicate with **Node**, you will need 128-bit **`API TOKEN`** generated by Node on the first run. By default, this file is stored in **Node** data directory:

{{% tabs %}}

{{% tab "Linux" %}}
{{< highlight base >}}
$HOME/.local/share/stegos/api.token
{{< / highlight >}}
{{% /tab %}}

{{% tab "macOS" %}}
{{< highlight base >}}
$HOME/Library/Application Support/stegos/api.token
{{< / highlight >}}
{{% /tab %}}

{{% tab "Windows" %}}
{{< highlight base >}}
C:\Users\$USER\AppData\Roaming\api.token
{{< / highlight >}}
{{% /tab %}}

{{% tab "Docker" %}}
{{< highlight base >}}
/data/api.token`
{{< / highlight >}}
{{% /tab %}}

{{% /tabs %}}

___

### Protocol

#### Framing

**API** uses **Text** WebSocket frames. Binary frames are no currently supported.

Each Text frame contains a Base64-encoded version of AES-128 encrypted JSON payload. This design decision was dictated by the limitations of Rust's WebSocket technology. We plan to switch to SSL/TLS in the future.

**Encoding:**

{{< highlight js >}}
payload = aes128_decode(base64_decode(websocket_text_message), API_TOKEN)
{{< / highlight >}}

**Decoding:**

{{< highlight js >}}
websocket_text_message = base64_encode(aes128_encode(payload), API_TOKEN)
{{< / highlight >}}

Here is basic example how to encode/decode AES messages:

{{% tabs %}}

{{% tab "Python" %}}
{{< highlight python "linenos=inline" >}}
import base64
import binascii
import json
import sys

from Crypto.Cipher import AES
from Crypto.Util import Counter
from Crypto import Random

def encrypt(key, plaintext):
    assert len(key) == 16

    # Choose a random, 16-byte IV.
    iv = Random.new().read(AES.block_size)

    # Convert the IV to a Python integer.
    iv_int = int(binascii.hexlify(iv), 16)

    # Create a new Counter object with IV = iv_int.
    ctr = Counter.new(AES.block_size * 8, initial_value=iv_int)

    # Create AES-CTR cipher.
    aes = AES.new(key, AES.MODE_CTR, counter=ctr)

    # Encrypt and return IV and ciphertext.
    ciphertext = aes.encrypt(plaintext)
    return iv+ciphertext

def decrypt(key, ciphertext):
    assert len(key) == 16

    # Convert the IV to a Python integer.
    iv_int = int(binascii.hexlify(ciphertext[:16]), 16)

    # Create a new Counter object with IV = iv_int.
    ctr = Counter.new(AES.block_size * 8, initial_value=iv_int)

    # Create AES-CTR cipher.
    aes = AES.new(key, AES.MODE_CTR, counter=ctr)

    # Decrypt and return the plaintext.
    plaintext = aes.decrypt(ciphertext[16:])
    return plaintext
{{< / highlight >}}
{{% /tab %}}

{{% tab "Rust" %}}
{{< highlight rust "linenos=inline" >}}
use crypto::aes::{self, KeySize};
use crypto::symmetriccipher::SynchronousStreamCipher;
use std::iter::repeat;

pub fn encrypt(key: [u8; 16], plaintext: &[u8]) -> Vec<u8> {
    let mut gen = thread_rng();
    let mut nonce: Vec<u8> = repeat(0u8).take(16).collect();
    gen.fill_bytes(&mut nonce[..]);
    let mut cipher = aes::ctr(KeySize::KeySize128, &key.0[..], &nonce);
    let mut output: Vec<u8> = repeat(0u8).take(16 + plaintext.len()).collect();
    output[..16].copy_from_slice(&nonce[..]);
    cipher.process(&plaintext, &mut output[16..]);
    output
}

pub fn decrypt(key: [u8; 16], ciphertext: &[u8]) -> Vec<u8> {
    let mut iv: Vec<u8> = repeat(0u8).take(16).collect();
    iv[..].copy_from_slice(&ciphertext[..16]);
    let mut cipher = aes::ctr(KeySize::KeySize128, &key.0[..], &iv);
    let mut output: Vec<u8> = repeat(0u8).take(ciphertext.len() - 16).collect();
    cipher.process(&ciphertext[16..], &mut output);
    output
}
{{< / highlight >}}
{{% /tab %}}

{{% /tabs %}}

#### Payload

Payload is just a pure JSON:

{{< highlight json "linenos=inline" >}}
{
  "id": 100500, 
  "type": "balance_info", 
  "account_id": "1", 
  "balance": 999996000
}
{{< / highlight >}}

There are two kinds of JSON messages:

1. Remote Procedure Calls (RPC) from a client to the server.
2. Out-of-band notifications from the server to a client.

#### Remote Procedure Calls

Remote procedure calls are similar to JSON-RPC:

**Sample request**:

{{< highlight json "linenos=inline" >}}
{
   "id":2, 
   "type":"balance_info"
   "account_id": "1", 
}
{{< / highlight >}}

**Sample response**:

{{< highlight json "linenos=inline" >}}
{
   "id":2, 
   "type":"balance_info", 
   "account_id": "1", 
   "balance":999996000
}
{{< / highlight >}}

The protocol supports multiplexing. Client library can send multiple requests at once on the same connection and receive responses back in any order. Please note, that responses are sent as soon as they are ready. Never rely on the order of responses and use `id` field for tracking! Optional field `id` can be used to map responses to requests. This field is opaque, i.e.your client library can generate some arbitrary `id` for each request and server will include provided value to a reply.

Field `type` is a discriminator of requests and responses as well as notifications (see below). A value of `type` in a request doesn't necessary matches the value of type field in a response. Some requests may return different types of responses. For example, any RPC request can end up with an error:

{{< highlight json "linenos=inline" >}}
{
  "type": "error", 
  "error": "Not enough money."
}
{{< / highlight >}}

#### Notifications

Out-of-band notifications are sent by server to notify a client about some events, e.g.when block has been added or accounts's balance has changed:

{{< highlight json "linenos=inline" >}}
{
  "type": "balance_changed", 
  "account_id": "1", 
  "balance": 999996010
}
{{< / highlight >}}

Notifications never have `id` field. For synchronous client library, you can filter out or notification based on type or presence of `id` fields.

___

### Wallet RPC API

Wallet RPC API is used to manage account and sending transactions.

One **Node** has exactly one **Wallet**. One **Wallet** can hold multiple **Accounts**. One **Account** has exactly one **Address**.**Address** is Base58-encoded public key of an **Account**:

{{< highlight js "linenos=inline" >}}
MAGIC_BYTE = 198
address = base58_check_encode(MAGIC_BYTE, curve25519_public_key)
{{< / highlight >}}

Each **Account** is uniquely identified its address. Since public keys are quite large, **Wallet** automatically assigns a short unique surrogate identifier to each keypair to use in API calls. This identifier is called by `account_id` . Please do not confuse with `account_pkey` which is an account public key.

Each **Account** has associated password. This password is used as a seed for a key derivation function for AES-128 encryption. Encryption protects a secret key and other sensitive data. Since this password is never stored in any way, there are no possible technical ways to recover it from the node. This obviously doesn't protect from possible leaks via side-channels or via Rubber-hose cryptanalysis.

Each **Account** can be recovered using 24-word **Recovery Phrase**. This recovery phrase is a mnemonic representation of raw account's secret key. Since this 24-word recovery phrase is just another representation of raw Curve25519 secret key, no password is needed to recover from it.

**Accounts** have concept of **Sealing**/**Unsealing**:

* **Sealed** account doesn't store sensitive information in the memory, such as secret key, balance, history and other.**Sealed** account can't create transaction and spent your money. Since secret key is not loaded, **Sealed** account also doesn't receive notifications about incoming payments.
* **Unsealed** account has secret key loaded into the memory.**Unsealed** account can create transactions, receive notification about incoming payments and perform other actions. In order to unseal account, a password is needed. Currently account is not **Sealed** automatically by a timeout, but this feature may be added in the future.

#### List Accounts

Returns a list of account.

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "accounts_info", 
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "accounts_info", 
  "accounts": {

    "1": {
      "account_pkey": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
    }
    

  }
}
{{< / highlight >}}

#### Create Account

Creates a new account.

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "create_account", 
  "password": "plain-text-password"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "account_created", 
  "account_id": "1"
}
{{< / highlight >}}

#### Delete Account

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "delete_account", 
  "account_id": "2"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "account_deleted", 
  "account_id": "2"
}
{{< / highlight >}}

#### Get Recovery Phrase

Returns 24-word recovery phrase.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "recovery_info"
  "account_id": "1", 
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "recovery", 
  "recovery": "swear praise ginger oxygen anchor ten small planet crime cave fold chuckle foot dragon decorate guess poverty grass crew depend define twice mother update"
}
{{< / highlight >}}

#### Recover Account

Recovers an account from 24-word recovery phrase:

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "recover_account"
  "recovery": "swear praise ginger oxygen anchor ten small planet crime cave fold chuckle foot dragon decorate guess poverty grass crew depend define twice mother update", 
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "account_created", 
  "account_id": "2"
}
{{< / highlight >}}

#### Unseal Account

Unseals an account, i.e.loads a secret key to the memory.

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "unseal"
  "account_id": "1", 
  "password": "plain-text-password"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "unsealed"
}
{{< / highlight >}}

#### Seal Account

Seals an account, i.e., removes an account's secret key from memory.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "seal"
  "account_id": "1", 
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "sealed"
}
{{< / highlight >}}

#### Change Password

Re-encrypts an account's sensitive data using a new password.

**Must be unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "change_password", 
  "new_password": "plain-text-password", 
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "password_changed"
}
{{< / highlight >}}

#### Account Information

Returns information about account's public key (address).

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "account_info", 
  "account_id": "1", 
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "account_info", 
  "account_pkey": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw", 
}
{{< / highlight >}}

#### Balance Information

Returns information about current and availabe account's balances.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "balance_info"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "balance_info", 
  "balance": 0, 
  "available_balance": 0
}
{{< / highlight >}}

`available_balance` doesn't include tokens used by pending transactions, locked-by-timestamp UTXO, stakes and Service Awards payouts.

#### UTXO Information

Returns information about account's UTXO.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "request": "unspent_info"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "unspent_info", 
  "public_payments": [], 
  "payments": [

    {
      "utxo": "13257da5cdef20d47dba473deb182f0d24c2a1ed717ba379c2b1830fdfadbd7e",
      "amount": 1000000000,
      "comment": "Gift from Stegos Leprechaun",
      "locked_timestamp": null,
      "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
      "is_change": false
    }
    

  ], 
  "stakes": []
}
{{< / highlight >}}

#### Payment

Creates a payment transaction to transfer money.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "payment", 
  "recipient": "7eiszB5iVFPCAWSmmkQ5ARyiLpvf1hifQrJ8FikJ1QJQ1k8WrQv", 
  "amount": 100, 
  "payment_fee": 1000, 
  "comment": "Test", 
  "locked_timestamp": "2019-08-22T12:35:06.343300856Z", 
  "with_certificate": false
}
{{< / highlight >}}

* `type` 
  + `payment` - cloaked outputs, but without using Snowball.
  + `secure_payment` - cloaked outputs + Snowball (recommended).
  + `public_payment` - Public (uncloaked) outputs.
* `recipient` - recipient's address.
* `amount` - amount in μSTG.
* `payment_fee` - desired fee per created UTXO.
* `comment` - a commentary, up to 880 chars.
* `locked_timestamp` - lock created UTXO until specified time.
* `with_certificate` - generate a proof of payment.

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "transaction_created", 
  "tx_hash": "b9132147148715da31d9ac95ec1efee9aec374deb356b3fedefc17322c3b63c2", 
  "fee": 2000, 
  "outputs": [

    {
      "output_type": "payment",
      "utxo": "32cbfd8cd697bef256b78a36847269a0d39c738da3cc474f3635c21b03de1310",
      "amount": 100,
      "comment": "Test",
      "locked_timestamp": "2019-08-22T12:35:06.343300856Z",
      "recipient": "7eiszB5iVFPCAWSmmkQ5ARyiLpvf1hifQrJ8FikJ1QJQ1k8WrQv",
      "rvalue": "0dbb132afbfdcc7bfb25191f89007f27919fceaceea03b015d98458cba1a4200",
      "is_change": false
    },
    {
      "output_type": "payment",
      "utxo": "fb7b7d39265ae69cc33fe5f327a78d0ea01a508ff99265f0a92ab5fc7df9e3c6",
      "amount": 999997900,
      "comment": "Change",
      "locked_timestamp": null,
      "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
      "is_change": true
    }
    

  ], 
  "inputs": [

    "13257da5cdef20d47dba473deb182f0d24c2a1ed717ba379c2b1830fdfadbd7e"
    

  ], 
  "status": "created"
}
{{< / highlight >}}

* `tx_hash` - a hash of created transaction.
* `fee` - the total fee for all outputs.
* `output_type` :
  + `payment` 
  + `public_payment` 
  + `stake` (see [Stake]({{< relref "#stake" >}}))
* `amount` - amount in μSTG.
* `comment` - a commentary.
* `rvalue` - saved encryption key (only if with_certificate).
* `locked_timestamp` - the UTXO is locked until this timestamp.
* `is_change` - the UTXO is a change
* `status` - transaction status:
  + `create` 
  + `accepted` - accepted into the local mempool.
  + `rejected` - rejected by the local mempool.
  + `prepared` - added to the blockchain.
  + `committed` - finalized by the consensus.
  + `conflicted` - rejected because of conflict with another TX.

#### Cloak

Exchange all uncloaked tokens to cloaked tokens.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "cloak_all", 
  "payment_fee": 1000
}
{{< / highlight >}}

**Response:**

See Payment.

#### Stake

Stake token into the escrow to become an validator.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "stake", 
  "amount": 2000, 
  "payment_fee": 1000
}
{{< / highlight >}}

**Response:**

See Payment.

#### Unstake

Unstake tokens from the escrow.

**Unsealed:** yes

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "unstake", 
  "account_id": "1", 
  "amount": 2000, 
  "payment_fee": 1000
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "type": "unstake_all", 
  "account_id": "1", 
}
{{< / highlight >}}

**Response:**

See Payment.

#### Restake

Forcefully re-stake (refresh) expering tokens in the escrow. Usually this operation is performed automatically by **Node8*.

**Unsealed:** no, secret key is not needed for this operation.

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "restake_all", 
}
{{< / highlight >}}

**Response:**

See Payment.

#### Validate Certificate

Validate a payment certificate for a payment. This API is doesn't require existing account.

Request:

{{< highlight json "linenos=inline" >}}
{
  "type": "validate_certificate", 
  "utxo": "0fdb42aa9433bc6f7079426ebbe0d5464ca713b2aad2bb5ff4fe163f98a80674", 
  "spender": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw", 
  "recipient": "7eiszB5iVFPCAWSmmkQ5ARyiLpvf1hifQrJ8FikJ1QJQ1k8WrQv", 
  "rvalue": "0dbb132afbfdcc7bfb25191f89007f27919fceaceea03b015d98458cba1a4200"
}
{{< / highlight >}}

* `rvalue` - UTXO encryption key, created by `payment` call when called with `with_certificate` option. See Payment for details.

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "certificate_valid", 
  "epoch": 1181, 
  "block_hash": "5e8a4429338ac775b40472d0cee6a439cbf0542c966bca9a089f1a84bdb2e680", 
  "is_final": true, 
  "timestamp": "2019-08-21T13:05:53.045364692Z", 
  "amount": 100
}
{{< / highlight >}}

* `epoch` - an epoch number when this UTXO was added to the blockchain.
* `block_hash` - a hash of the block.
* `is_final` - this block has been finalized.
* `timestamp` - a timestamp from the block.
* `amount` - decrypted amount.

#### Payment History

Validate a payment certificate for a payment. This API is doesn't require existing account.

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "history_info", 
  "starting_from": "2019-08-20T13:48:40.877231494Z", 
  "limit": 50
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{                                                                                                                            [31/9149]
  "account_id": "1", 
  "type": "history_info", 
  "log": [

    {
      "type": "outgoing",
      "timestamp": "2019-08-21T13:36:29.038362377Z",
      "tx_hash": "e2b3b05056dc216ed514422b4b08d2b7107947fdddbfb419faa87caa10400404",
      "fee": 6000,
      "outputs": [
        {
          "output_type": "payment",
          "utxo": "17a23f878dfecd0bdbd9bfd3524b829a95eb2d6a121f4f9d08160aa3b7da789a",
          "amount": 1,
          "comment": "",
          "locked_timestamp": null,
          "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
          "is_change": false
        },
        {
          "output_type": "payment",
          "utxo": "2ddb5b4b52ff2f54341c2f03e18e053843e964e86a4d48abb65f80c2ad09231d",
          "amount": 999986699,
          "comment": "Change",
          "locked_timestamp": null,
          "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
          "is_change": true
        }
      ],
      "inputs": [                                                                                                             [2/9149]
        "5f8778d614aa6264269f62b5edb18f983e8da12b045b0cb314619456b930981e",
        "cc2a9b0268a36409a65166e4063abb88b4fe541e0c4a79eae4b66a3990a94868",
        "cef3b6ca7aa04383ee20c95b9c0071d751fa6b19e6ca75760e86380d402ed597",
        "ab55e0f121b3e3eff5c12f436abf3d1238171d86b3bd107f2ced160562dd1829",
        "0274559883bcf3668ec6751392633524854010267be6fcfc9a10c3c0d5cc4751",
        "d817af24a0344596c95f5c34d4afe4fe1fa2e184283267313ac878c1f912e90f"
      ],
      "status": "committed",
      "epoch": 1213
    },
    {
      "type": "incoming",
      "timestamp": "2019-08-21T13:36:30.798523887Z",
      "output_type": "payment",
      "utxo": "17a23f878dfecd0bdbd9bfd3524b829a95eb2d6a121f4f9d08160aa3b7da789a",
      "amount": 1,
      "comment": "",
      "locked_timestamp": null,
      "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
      "is_change": false
    },
    {
      "type": "incoming",
      "timestamp": "2019-08-21T13:36:30.799013899Z",
      "output_type": "payment",
      "utxo": "2ddb5b4b52ff2f54341c2f03e18e053843e964e86a4d48abb65f80c2ad09231d",
      "amount": 999986699,
      "comment": "Change",
      "locked_timestamp": null,
      "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
      "is_change": true
    }
    

  ]
}
{{< / highlight >}}

___

#### Wallet Notifications

Out of band notifications.

#### Balance Changed

Sent when an account's balance has been changed.

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "balance_changed", 
  "balance": 999988700, 
  "available_balance": 999988700
}
{{< / highlight >}}

#### Tokens Received

Sent when an account has received some tokens.

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "received", 
  "utxo": "cef3b6ca7aa04383ee20c95b9c0071d751fa6b19e6ca75760e86380d402ed597", 
  "amount": 999988699, 
  "comment": "Change", 
  "locked_timestamp": null, 
  "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw", 
  "is_change": false
}
{{< / highlight >}}

#### Tokens Spent

Sent when an account has spent some tokens.

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "spent", 
  "utxo": "8c662fb663b59dcedf60a9db59edc88cefdc36c2db50d8ce8db105fd0af58004", 
  "amount": 999990700, 
  "comment": "Change", 
  "locked_timestamp": null, 
  "pending_timestamp": "2019-08-21T13:21:05.168083847Z", 
  "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw", 
  "is_change": false
}
{{< / highlight >}}

#### Tokens Staked

Sent when an account staked some tokens into the escrow.

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "staked", 
  "utxo": "47c1b06d67794d72d2a5538f233823d6819b7ff6f8a73ddc41a3c8bbc08b74ce", 
  "account_pkey": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw", 
  "active_until_epoch": 1194, 
  "is_active": true, 
  "amount": 2000
}
{{< / highlight >}}

#### Tokens Unstaked

Sent when an account unsteaked some tokens have from the escrow.

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "unstaked", 
  "utxo": "8b3fdbec4c3435dee88d1a3fabb7db4cb08805bbef9ad213d8d04d483168a1d1", 
  "account_pkey": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw", 
  "active_until_epoch": 1191, 
  "is_active": true, 
  "amount": 2000
}
{{< / highlight >}}

#### Transaction Status

Sent when TX status has changed. See Payment.

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "transaction_status", 
  "tx_hash": "049db1e1979f2c8d876df876011f12764fb8ef5c578203dcba35bb9a8f09cfa3", 
  "status": "committed", 
  "epoch": 1192
}
{{< / highlight >}}

#### Snowball Status

Sent when Snowball status has changed. See Payment.

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "pool_wait"
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "shared_keying"
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "commitment"
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "cloaked_vals"
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "succeeded"
}
{{< / highlight >}}

___

### Node RPC API

#### Escrow Information

Show UTXO in the escrow, 

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "escrow_info"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "escrow_info", 
  "validators": [

    {
      "network_pkey": "c4dad2cd223433429ebd4bb25e25e447c6f1d97d9ac97336a02fe0321129224a6b30d69fe6f7c29e9af1e7328e033607a91e5d732673d4b
    

bbbd38e666ddf86d99a9dc709513b5537d7e723349ecacdb1992c861dce8e49ac6fb329f703646985", 

      "active_stake": 100000000000,
      "expired_stake": 0,
      "stakes": [
        {
          "utxo": "2cc4cd0ba92efe9ee3f55fe7253ba2d8d2bbc488c3275c293ae084e30d94a58a",
          "account_pkey": "7fLGYDXAwrD4miZaFwSQ5Ts6RRGmZheFAdhVNhu6wqGcXyJXLcn",
          "active_until_epoch": 1200,
          "is_active": true,
          "amount": 100000000000
        }
      ]
    },
    

  ]
}
{{< / highlight >}}

#### Election Information

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "election_info"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "election_info", 
  "epoch": 1199, 
  "offset": 40, 
  "view_change": 0, 
  "slots_count": 1000, 
  "current_leader": "ba6419bc26c8505a83222815a2c0459a43a377f9331b481c522aaa2473b0b3cd48cba7fd953b51303c45e018b17a310efce926b8ac11be8904a0ac74150ee8c503b616925a6742031668b421054aba0469e6fa223131a57a5370ac630a5091b5", 
}
{{< / highlight >}}

#### Enable Restaking

**Request:**

{{< highlight json "linenos=inline" >}}
{
  "type": "enable_restaking"
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "type": "restaking_enabled"
}
{{< / highlight >}}

**Response:**

{{< highlight json "linenos=inline" >}}
{
  "type": "disable_restaking"
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "type": "restaking_disabled"
}
{{< / highlight >}}

#### Pop Block

Pop the last unconfirmed block. For debug purposes only.

{{< highlight json "linenos=inline" >}}
{
  "type": "pop_block"
}
{{< / highlight >}}

{{< highlight json "linenos=inline" >}}
{
  "type": "block_popped"
}
{{< / highlight >}}

___

### Node Notifications

#### Synchronization Status Changed

{{< highlight json "linenos=inline" >}}
{
  "type": "sync_changed", 
  "is_synchronized": true, 
  "epoch": 1203, 
  "offset": 32, 
  "view_change": 0, 
  "last_block_hash": "58400c4fb82d5e7f5baa34f6d23ae76f01dc1f789910aa73380f78da5f646d5e", 
  "last_macro_block_hash": "64e53a321c9bc160574eefec84b2961f358e449ff73efa2c6d2b47afd9681196", 
  "last_macro_block_timestamp": "2019-08-21T13:26:07.559157693Z", 
  "local_timestamp": "2019-08-21T13:26:40.984563552Z"
}
{{< / highlight >}}

#### New Micro Block

{{< highlight json "linenos=inline" >}}
{
  "type": "new_micro_block", 
  "epoch": 1203, 
  "offset": 31, 
  "statuses": {

    "891cd7863bdf3775f8c95b0dbf12d33393b16186c6a55761addcb42fdb6a69de": {
      "status": "prepared",
      "epoch": 1203,
      "offset": 31
    }
    

  }
}
{{< / highlight >}}

#### Rollback Micro Block

WIP

#### New Macro Block

WIP

___

### Use Cases

#### Transaction Tracking

1) Initiate a new transaction by using `payment` , `secure_payment` or `public_payment` call:

{{< highlight json "linenos=inline" >}}
{
  "type": "secure_payment", 
  "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw", 
  "amount": 1, 
  "payment_fee": 1000, 
  "comment": "", 
  "locked_timestamp": null, 
  "with_certificate": false
}
{{< / highlight >}}

See Payment for details.

2) Wait until TX is created by the Wallet:

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "transaction_created", 
  "tx_hash": "3de346b3c41f173b931f18bb9baf300afaa4724052c01efa008333f8a0e881d4", 
  "fee": 2000, 
  "outputs": [

    {
      "output_type": "payment",
      "utxo": "17c6556fbe25ccc7e7e8adb3e2000366cdef08e19d36478b5716c24778ecb3b2",
      "amount": 1,
      "comment": "",
      "locked_timestamp": null,
      "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
      "is_change": false
    },
    {
      "output_type": "payment",
      "utxo": "eb05b05c5dd4c6f972b85f5848ccaa75fc7d49cb3b10009f6559e0274e92dd16",
      "amount": 999982699,
      "comment": "Change",
      "locked_timestamp": null,
      "recipient": "7eAYuCBLQJNomPM7dHEmAp3Ku7H3wv76MdqpRBiuYdJseNwqcfw",
      "is_change": true
    }
    

  ], 
  "inputs": [

    "299512da5957b689b0862ef080cc64e54593ab6d1db74b426608a60ce7f1df2f",
    "ae485d68ef6dbc4b17a6ad61befbb8ce072e10341eb2f827246bd321cf8b4b07"
    

  ], 
  "status": "created"
}
{{< / highlight >}}

TX has been created and sent to the Node.
For Snowball ( `secure_payment` ) transactions you will also see intermediate `snowball_status` notifications between `secure_payment` request and `transaction_created` response:

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "pool_wait"
}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "commitment"
}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "cloaked_vals"
}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "signature"
}
{
  "account_id": "1", 
  "type": "snowball_status", 
  "state": "succeeded"
}
{{< / highlight >}}

3) Wait until TX is accepted into a mempool:

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "transaction_status", 
  "tx_hash": "3de346b3c41f173b931f18bb9baf300afaa4724052c01efa008333f8a0e881d4", 
  "status": "accepted"
}
{{< / highlight >}}

TX has been accepted into Node's mempool.

4) Wait until the transaction is added to a block:

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "transaction_status", 
  "tx_hash": "3de346b3c41f173b931f18bb9baf300afaa4724052c01efa008333f8a0e881d4", 
  "status": "prepared", 
  "epoch": 1230, 
  "offset": 56
}
{{< / highlight >}}

TX has been added to the blockchain.

5) Wait until TX is finalized by consensus:

{{< highlight json "linenos=inline" >}}
{
  "account_id": "1", 
  "type": "transaction_status", 
  "tx_hash": "3de346b3c41f173b931f18bb9baf300afaa4724052c01efa008333f8a0e881d4", 
  "status": "committed", 
  "epoch": 1230, 
}
{{< / highlight >}}

TX has been finalized by PoS consensus.

